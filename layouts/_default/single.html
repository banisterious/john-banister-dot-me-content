{{ define "main" }}
{{ .Scratch.Set "scope" "single" }}

<article>

  <!-- âœ… Patreon Authentication Check -->
  <script>
      document.addEventListener("DOMContentLoaded", function() {
          const token = localStorage.getItem("patreon_access");

          // Redirect users to Patreon login if they don't have an access token
          if (!token) {
              window.location.href = "/patreon-auth";
          } else {
              document.getElementById("exclusive-content-section").style.display = "block";
          }
      });
  </script>

  {{ if .Params.showHero | default (.Site.Params.article.showHero | default false) }}
  {{ $heroStyle := .Params.heroStyle }}
  {{ if not $heroStyle }}{{ $heroStyle = .Site.Params.article.heroStyle }}{{ end }}
  {{ $heroStyle := print "partials/hero/" $heroStyle ".html" }}
  {{ if templates.Exists $heroStyle }}
  {{ partial $heroStyle . }}
  {{ else }}
  {{ partial "partials/hero/basic.html" . }}
  {{ end }}
  {{ end }}

  <header id="single_header" class="mt-5 max-w-prose">
    <h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">
      {{ .Title | emojify }}
    </h1>
    <div class="mt-1 mb-6 text-base text-neutral-500 dark:text-neutral-400 print:hidden">
      {{ partial "article-meta/basic.html" (dict "context" . "scope" "single") }}
    </div>
  </header>

  <!-- âœ… Hide Content Until Patreon Login -->
  <section id="exclusive-content-section" class="flex flex-col max-w-full mt-0 prose dark:prose-invert lg:flex-row" style="display: none;">
    
    <div class="min-w-0 min-h-0 max-w-fit">
        
      {{ partial "series/series.html" . }}

      <div class="article-content max-w-prose mb-20">
        {{ .Content }}
      </div>
    </div>

  </section>

  <!-- âœ… Show "Access Denied" Message If JavaScript Fails -->
  <noscript>
    <section class="flex flex-col max-w-full mt-0 prose dark:prose-invert lg:flex-row">
      <div class="min-w-0 min-h-0 max-w-fit text-center">
        <h2>ðŸ”’ Access Denied</h2>
        <p>You must be a Patreon supporter to view this content.</p>
        <a href="/patreon-auth" class="px-4 py-2 bg-primary-500 text-white rounded">Login with Patreon</a>
      </div>
    </section>
  </noscript>

  <footer class="pt-8 max-w-prose print:hidden">
    {{ partial "article-pagination.html" . }}
  </footer>

</article>
{{ end }}
